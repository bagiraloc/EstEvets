<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–ó–æ–ª–æ—Ç–∞ –û—Å—ñ–Ω—å 2025 üçÅ</title>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import { getDatabase, ref, onValue, set, remove } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDBXt2gMo92d6MpzxdzEvLI8UMcyHipVTg",
    authDomain: "estevents.firebaseapp.com",
    databaseURL: "https://estevents-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "estevents",
    storageBucket: "estevents.firebasestorage.app",
    messagingSenderId: "227576344701",
    appId: "1:227576344701:web:adf679a530b4ce72d5c114",
    measurementId: "G-3ZDEP57KXF"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  // ‚ûï –î–æ–¥–∞–≤–∞–Ω–Ω—è –≥—ñ–º–Ω–∞—Å—Ç–∫–∏
  window.addGymnast = async function() {
    const name = document.getElementById("name").value.trim();
    const club = document.getElementById("club").value.trim();
    const event = document.getElementById("event").value;
    const score = parseFloat(document.getElementById("score").value.replace(",", "."));

    if (!name || !club || !event || isNaN(score)) {
      alert("–ë—É–¥—å –ª–∞—Å–∫–∞, –∑–∞–ø–æ–≤–Ω—ñ—Ç—å –≤—Å—ñ –ø–æ–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ!");
      return;
    }

    const gymnastRef = ref(db, "gymnasts/" + name.replace(/\s+/g, "_"));
    const snapshot = await new Promise(resolve => {
      onValue(gymnastRef, resolve, { onlyOnce: true });
    });

    let data = snapshot.val() || { name, club, obruƒç: 0, myach: 0, bu≈Çavy: 0, strichka: 0, suma: 0 };
    data[event] = score;
    data.suma = (data.obruƒç || 0) + (data.myach || 0) + (data.bu≈Çavy || 0) + (data.strichka || 0);
    await set(gymnastRef, data);

    document.getElementById("name").value = "";
    document.getElementById("club").value = "";
    document.getElementById("score").value = "";
  };

  // üßπ –û—á–∏—Å—Ç–∏—Ç–∏ –≤—Å—ñ –¥–∞–Ω—ñ
  window.clearAll = async function() {
    if (confirm("–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –ø–æ–≤–Ω—ñ—Å—Ç—é –æ—á–∏—Å—Ç–∏—Ç–∏ —Ç–∞–±–ª–∏—Ü—é?")) {
      const gymnastsRef = ref(db, "gymnasts");
      await set(gymnastsRef, {});
      alert("–¢–∞–±–ª–∏—Ü—é –æ—á–∏—â–µ–Ω–æ!");
    }
  };

  // ‚ùå –í–∏–¥–∞–ª–µ–Ω–Ω—è –æ–∫—Ä–µ–º–æ—ó –≥—ñ–º–Ω–∞—Å—Ç–∫–∏
  window.deleteGymnast = async function(name) {
    if (confirm(`–í–∏–¥–∞–ª–∏—Ç–∏ ${name}?`)) {
      const gymnastRef = ref(db, "gymnasts/" + name.replace(/\s+/g, "_"));
      await remove(gymnastRef);
    }
  };

  // ‚öôÔ∏è –ü–æ–∫–∞–∑–∞—Ç–∏/—Å—Ö–æ–≤–∞—Ç–∏ –ø–∞–Ω–µ–ª—å ‚Äî –ù–ê–î–Ü–ô–ù–ê –†–ï–ê–õ–Ü–ó–ê–¶–Ü–Ø
  window.togglePanel = function() {
    const panel = document.getElementById("editPanel");
    if (!panel) return;
    // –Ø–∫—â–æ –≤–∂–µ –≤–∏–¥–∏–º–∞ ‚Äî –∑–∞—Ö–æ–≤–∞—Ç–∏
    if (panel.classList.contains("visible")) {
      panel.classList.remove("visible");
      // —è–≤–Ω–µ —Å—Ö–æ–≤–∞–Ω–Ω—è —á–µ—Ä–µ–∑ —Å—Ç–∏–ª—ñ –¥–ª—è —Å—É–º—ñ—Å–Ω–æ—Å—Ç—ñ
      panel.style.bottom = "-260px";
      // –∑–±–µ—Ä–µ–≥—Ç–∏ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å —Ñ–æ–∫—É—Å—É
      panel.setAttribute("aria-hidden", "true");
    } else {
      // –ø–æ–∫–∞–∑–∞—Ç–∏
      panel.classList.add("visible");
      panel.style.bottom = "10px";
      panel.setAttribute("aria-hidden", "false");
      // –Ω–∞ –º–æ–±—ñ–ª—å–Ω–∏—Ö —Ñ–æ–∫—É—Å –Ω–∞ –ø–µ—Ä—à–µ –ø–æ–ª–µ
      const inp = panel.querySelector("input#name");
      if (inp) setTimeout(() => inp.focus(), 300);
    }
  };

  // üìä –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Ç–∞–±–ª–∏—Ü—ñ
  const tableBody = document.getElementById("gymnastTable");

  onValue(ref(db, "gymnasts"), snapshot => {
    const data = snapshot.val() || {};
    const arr = Object.values(data).sort((a, b) => b.suma - a.suma);

    tableBody.innerHTML = "";
    arr.forEach((g, i) => {
      const row = document.createElement("tr");
      const crown = i === 0 ? "üëë" : "";
      row.classList.add("fly-in");
      row.innerHTML = `
        <td>${i + 1}</td>
        <td class="${i === 0 ? 'shine' : ''}">${crown} ${g.name}</td>
        <td>${g.club}</td>
        <td>${g.obruƒç || "-"}</td>
        <td>${g.myach || "-"}</td>
        <td>${g.bu≈Çavy || "-"}</td>
        <td>${g.strichka || "-"}</td>
        <td><b>${g.suma.toFixed(3)}</b></td>
        <td><button class="leaf-btn" onclick="deleteGymnast('${g.name.replace(/'/g,"\\'")}')">üçÅ</button></td>
      `;
      tableBody.appendChild(row);
      setTimeout(() => row.classList.remove("fly-in"), 1000);
    });
  });

  // üçÇ –ê–Ω—ñ–º–∞—Ü—ñ—è –ª–∏—Å—Ç–∫—ñ–≤
  function createLeaf() {
    const leaf = document.createElement("div");
    leaf.classList.add("leaf");
    leaf.textContent = "üçÅ";
    leaf.style.left = Math.random() * 100 + "vw";
    leaf.style.animationDuration = 5 + Math.random() * 10 + "s";
    leaf.style.fontSize = 20 + Math.random() * 20 + "px";
    document.body.appendChild(leaf);
    setTimeout(() => leaf.remove(), 15000);
  }
  setInterval(createLeaf, 500);
</script>

<style>
body {
  background-color: #0d0d0d;
  color: #f6c453;
  font-family: "Segoe UI", sans-serif;
  overflow-x: hidden;
  margin: 0;
}

h1 {
  text-align: center;
  color: #f6c453;
  text-shadow: 0 0 20px #f6c453;
  margin-top: 10px;
}

.leaf {
  position: fixed;
  top: -10vh;
  color: #f6c453;
  opacity: 0.9;
  animation: fall linear infinite;
  z-index: 0;
}

@keyframes fall {
  0% { transform: translateY(0) rotate(0deg); opacity: 1; }
  100% { transform: translateY(110vh) rotate(360deg); opacity: 0; }
}

.table-container {
  width: 100%;
  display: flex;
  justify-content: center;
  align-items: center;
}

table {
  border-collapse: collapse;
  background: rgba(30,30,30,0.9);
  border-radius: 14px;
  box-shadow: 0 0 20px rgba(246,196,83,0.3);
}

th, td {
  padding: 6px 8px;
  text-align: center;
  color: #f6c453;
  white-space: nowrap;
}

th {
  background-color: #1e1e1e;
  border-bottom: 2px solid #f6c453;
}

.fly-in {
  animation: flyIn 0.8s ease-out;
}

@keyframes flyIn {
  from { transform: translateY(100vh); opacity: 0; }
  to { transform: translateY(0); opacity: 1; }
}

#editPanel {
  position: fixed;
  bottom: -250px;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(13,13,13,0.95);
  padding: 12px;
  text-align: center;
  box-shadow: 0 -2px 10px rgba(246,196,83,0.2);
  border-radius: 12px;
  width: 95%;
  z-index: 20;
  transition: bottom 0.35s ease;
}
#editPanel.visible {
  /* –¥–æ–¥–∞—Ç–∫–æ–≤–∏–π –∫–ª–∞—Å ‚Äî –¥–ª—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—ñ/—Å—Ç–∞—Ç—É—Å—É, —Å—Ç–∏–ª—å –Ω–∏–∂—á–µ –∫–µ—Ä—É—î—Ç—å—Å—è –∑ JS */
}

input, select {
  background: #1e1e1e;
  color: #f6c453;
  border: 1px solid #f6c453;
  border-radius: 6px;
  padding: 4px 8px;
  margin: 3px;
}

button {
  background: linear-gradient(90deg, #f6c453, #b8860b);
  color: #0d0d0d;
  border: none;
  border-radius: 6px;
  padding: 6px 12px;
  font-weight: bold;
  margin: 3px;
  cursor: pointer;
}

button:hover {
  background: linear-gradient(90deg, #ffd700, #f6c453);
}

.leaf-btn {
  background: none;
  border: none;
  font-size: 20px;
  cursor: pointer;
  transition: transform 0.2s ease;
}
.leaf-btn:hover {
  transform: scale(1.3) rotate(15deg);
}

.shine {
  color: #fff799;
  text-shadow: 0 0 10px #fff799, 0 0 20px #ffcc33;
  animation: glow 1.5s infinite alternate;
}

@keyframes glow {
  from { text-shadow: 0 0 1
