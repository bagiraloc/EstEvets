<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–ó–æ–ª–æ—Ç–∞ –û—Å—ñ–Ω—å 2025 üçÅ</title>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import { getDatabase, ref, push, onValue, set, update } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDBXt2gMo92d6MpzxdzEvLI8UMcyHipVTg",
    authDomain: "estevents.firebaseapp.com",
    databaseURL: "https://estevents-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "estevents",
    storageBucket: "estevents.firebasestorage.app",
    messagingSenderId: "227576344701",
    appId: "1:227576344701:web:adf679a530b4ce72d5c114",
    measurementId: "G-3ZDEP57KXF"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  // –î–æ–¥–∞—î–º–æ –Ω–æ–≤—É —É—á–∞—Å–Ω–∏—Ü—é
  window.addGymnast = async function() {
    const name = document.getElementById("name").value.trim();
    const club = document.getElementById("club").value.trim();
    const event = document.getElementById("event").value;
    const score = parseFloat(document.getElementById("score").value.replace(",", "."));

    if (!name || !club || !event || isNaN(score)) {
      alert("–ë—É–¥—å –ª–∞—Å–∫–∞, –∑–∞–ø–æ–≤–Ω—ñ—Ç—å –≤—Å—ñ –ø–æ–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ!");
      return;
    }

    const gymnastRef = ref(db, "gymnasts/" + name.replace(/\s+/g, "_"));

    // –ó—á–∏—Ç—É—î–º–æ –ø–æ—Ç–æ—á–Ω—ñ –æ—Ü—ñ–Ω–∫–∏ (—è–∫—â–æ –≤–∂–µ –≤–∏—Å—Ç—É–ø–∞–ª–∞)
    const snapshot = await new Promise(resolve => {
      onValue(gymnastRef, resolve, { onlyOnce: true });
    });

    let data = snapshot.val() || { name, club, obruƒç: 0, myach: 0, bu≈Çavy: 0, strichka: 0, suma: 0 };

    // –ó–∞–ø–∏—Å—É—î–º–æ –Ω–æ–≤—É –æ—Ü—ñ–Ω–∫—É –¥–ª—è –æ–±—Ä–∞–Ω–æ–≥–æ –≤–∏–¥—É
    data[event] = score;
    data.suma = (data.obruƒç || 0) + (data.myach || 0) + (data.bu≈Çavy || 0) + (data.strichka || 0);
    await set(gymnastRef, data);

    // –û—á–∏—â–∞—î–º–æ —Ñ–æ—Ä–º—É
    document.getElementById("name").value = "";
    document.getElementById("club").value = "";
    document.getElementById("score").value = "";

    alert("‚úÖ –î–∞–Ω—ñ –∑–±–µ—Ä–µ–∂–µ–Ω–æ!");
  };

  // –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Ç–∞–±–ª–∏—Ü—ñ –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ
  const tableBody = document.getElementById("gymnastTable");

  onValue(ref(db, "gymnasts"), snapshot => {
    const data = snapshot.val() || {};
    const arr = Object.values(data).sort((a, b) => b.suma - a.suma);
    tableBody.innerHTML = "";
    arr.forEach((g, i) => {
      const row = document.createElement("tr");
      if (i === 0) g.name = "üëë " + g.name;
      row.innerHTML = `
        <td>${i + 1}</td>
        <td>${g.name}</td>
        <td>${g.club}</td>
        <td>${g.obruƒç || "-"}</td>
        <td>${g.myach || "-"}</td>
        <td>${g.bu≈Çavy || "-"}</td>
        <td>${g.strichka || "-"}</td>
        <td><b>${g.suma.toFixed(3)}</b></td>
      `;
      tableBody.prepend(row);
    });
  });
</script>

<style>
body {
  background-color: #0d0d0d;
  color: #f6c453;
  font-family: "Segoe UI", sans-serif;
  overflow-x: hidden;
}
h1 {
  text-align: center;
  color: #f6c453;
  text-shadow: 0 0 20px #f6c453;
  margin-top: 20px;
}
.leaf {
  position: fixed;
  top: -10vh;
  color: #ffd700;
  font-size: 28px;
  opacity: 0.8;
  animation: fall linear infinite;
  z-index: -1;
}
@keyframes fall {
  0% { transform: translateY(0) rotate(0deg); }
  100% { transform: translateY(110vh) rotate(360deg); }
}
table {
  width: 95%;
  margin: 20px auto;
  border-collapse: collapse;
  background: rgba(30,30,30,0.9);
  border-radius: 14px;
  box-shadow: 0 0 20px rgba(246,196,83,0.3);
}
th, td {
  padding: 6px;
  text-align: center;
  color: #f6c453;
}
th {
  background-color: #1e1e1e;
  border-bottom: 2px solid #f6c453;
}
tfoot {
  position: fixed;
  bottom: 0;
  width: 100%;
  background: rgba(13,13,13,0.9);
  padding: 10px;
  text-align: center;
  box-shadow: 0 -2px 10px rgba(246,196,83,0.2);
}
input, select {
  background: #1e1e1e;
  color: #f6c453;
  border: 1px solid #f6c453;
  border-radius: 6px;
  padding: 4px 8px;
}
button {
  background: linear-gradient(90deg, #f6c453, #b8860b);
  color: #0d0d0d;
  border: none;
  border-radius: 6px;
  padding: 5px 10px;
  font-weight: bold;
}
button:hover {
  background: linear-gradient(90deg, #ffd700, #f6c453);
}
</style>
</head>

<body>
  <h1>–ó–æ–ª–æ—Ç–∞ –û—Å—ñ–Ω—å 2025 üçÅ</h1>
  <table>
    <thead>
      <tr>
        <th>–ú—ñ—Å—Ü–µ</th>
        <th>–Ü–º‚Äô—è</th>
        <th>–ö–ª—É–±</th>
        <th>–û–±—Ä—É—á</th>
        <th>–ú‚Äô—è—á</th>
        <th>–ë—É–ª–∞–≤–∏</th>
        <th>–°—Ç—Ä—ñ—á–∫–∞</th>
        <th>–°—É–º–∞</th>
      </tr>
    </thead>
    <tbody id="gymnastTable"></tbody>
  </table>

  <tfoot>
    <input type="text" id="name" placeholder="–Ü–º‚Äô—è">
    <input type="text" id="club" placeholder="–ö–ª—É–±">
    <select id="event">
      <option value="obruƒç">–û–±—Ä—É—á</option>
      <option value="myach">–ú‚Äô—è—á</option>
      <option value="bu≈Çavy">–ë—É–ª–∞–≤–∏</option>
      <option value="strichka">–°—Ç—Ä—ñ—á–∫–∞</option>
    </select>
    <input type="text" id="score" placeholder="–û—Ü—ñ–Ω–∫–∞ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥ 27.650)">
    <button onclick="addGymnast()">–î–æ–¥–∞—Ç–∏</button>
  </tfoot>
</body>
</html>
